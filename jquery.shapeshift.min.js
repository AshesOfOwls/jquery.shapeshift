(function(e,c,g){var d="shapeshift",a=c.document,f={animated:true,animatedOnDrag:true,centerGrid:true,columns:null,draggable:true,objWidth:null,gutterX:10,gutterY:10,resizable:true,selector:""};function b(j,h){var i=this;i.element=j;i.options=e.extend({},f,h);i._defaults=f;i._name=d;i.containerHeight=100;i.hoverObjPositions=[];i.init()}b.prototype.init=function(){var i=this,h=i.options;i.shiftit(h.animated);if(h.draggable){i.draggable()}if(h.resizable){i.resizable()}};b.prototype.shiftit=function(l){var k=this,i=k.options,m=e(k.element),j=m.children(i.selector).filter(":visible");if(!i.draggable){m.droppable("destroy");j.draggable("destroy");j.droppable("destroy")}positions=k.getObjectPositions(":visible");for(var o=0;o<j.length;o++){var n=e(j[o]),h=positions[o];if(!n.hasClass("ss-moving")){if(l){n.stop(true,false).animate(h,250)}else{n.css(h)}}}m.css("height",k.containerHeight)};b.prototype.draggable=function(){var o=this,p=o.options,n=e(o.element),j=n.children(p.selector).filter(":visible"),h=null,m=false;j.draggable({containment:"document",cursor:"move",start:function(q){l(e(this),q)},drag:function(q){i(e(this),q)}});n.droppable({drop:function(){k()}});function l(q,r){h=q;h.addClass("ss-moving");o.setHoverObjPositions();o.shiftit(p.animatedOnDrag)}function i(q,r){if(!m){j=n.children(p.selector).filter(":visible");m=true;intendedIndex=o.getIntendedIndex(q,r);$intendedObj=e(j.not(".ss-moving").get(intendedIndex));h.insertBefore($intendedObj);o.shiftit(p.animatedOnDrag);c.setTimeout(function(){m=false},200)}}function k(){h.removeClass("ss-moving");o.shiftit(p.animateOnDrag);n.trigger("shapeshifted",h)}};b.prototype.getIntendedIndex=function(h,k){var q=this,r=q.options,o=e(q.element),m=h.position().left,l=h.position().top,j=m+((k.pageX-h.offset().left)/2),i=l+((k.pageY-h.offset().top)/2),n=9999,p=0;for(hov_i=0;hov_i<q.hoverObjPositions.length;hov_i++){attributes=q.hoverObjPositions[hov_i];if(j>attributes.left&&i>attributes.top){xDist=j-attributes.left;yDist=i-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<n){n=distance;p=hov_i}}}return p};b.prototype.setHoverObjPositions=function(){var h=this;h.hoverObjPositions=h.getObjectPositions(":not(.ss-moving):visible")};b.prototype.getObjectPositions=function(j){var x=this,y=x.options,w=e(x.element),r=w.children(y.selector).filter(j),m=y.columns,u=[],q=null,t=0,p=[];if(!y.objWidth){y.objWidth=r.first().outerWidth(true)}q=y.objWidth+y.gutterX;if(!m){m=Math.floor(w.innerWidth()/q)}if(y.centerGrid){t=Math.floor(((w.innerWidth()/q)%1*q)/2)}for(var o=0;o<m;o++){u.push(0)}for(var l=0;l<r.length;l++){var h=e(r[l]),k=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+y.gutterY,s=(q*k)+t,n=u[k];attributes={left:s,top:n};p[l]=attributes;u[k]+=v}x.containerHeight=Math.max.apply(Math,u);return p};b.prototype.resizable=function(){var j=this,i=j.options,h=false;e(c).on("resize",function(){if(!h){h=true;j.shiftit(i.animated);setTimeout(function(){h=false;j.shiftit(i.animated)},100)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));