(function(e,c,g){var d="shapeshift",a=c.document,f={centerGrid:true,enableAnimation:true,enableAutoHeight:true,enableDrag:true,enableDragAnimation:true,enableResize:true,animateSpeed:150,childWidth:null,columns:null,dragBlacklist:null,dragClone:false,dropCutoff:0,dropWhitelist:"*",gutterX:10,gutterY:10,paddingY:0,paddingX:0,selector:""};function b(j,h){var i=this;i.element=j;i.container=e(j);i.options=e.extend({},f,h);i.init()}b.prototype.init=function(){var h=this,i=e(h.element);h.eventSetup();i.trigger("ss-event-arrange")};b.prototype.eventSetup=function(){var i=this,h=i.options,j=e(i.element);j.off("ss-event-arrange").on("ss-event-arrange",function(){i.arrange()});j.off("ss-event-dragreset").on("ss-event-dragreset",function(){j.droppable().droppable("destroy");j.children().draggable().draggable("destroy");i.drag()});j.droppable().droppable("destroy");j.children().draggable().draggable("destroy");if(h.enableDrag){i.drag()}if(h.enableResize){i.resize()}};b.prototype.arrange=function(){var k=this,i=k.options,m=e(k.element),j=m.children(i.selector).filter(":visible"),l=true;if(j.filter(".ss-moving")[0]){l=i.enableDragAnimation}else{l=i.enableAnimation}positions=k.getPositions(m,false);for(var o=0;o<j.length;o++){var n=e(j[o]),h=positions[o];if(!n.hasClass("ss-moving")){if(l){n.stop(true,false).animate(h,i.animateSpeed)}else{n.css(h)}}}m.css("height",i.containerHeight)};b.prototype.drag=function(){var p=this,q=p.options,o=$curContainer=e(p.element),k=o.children(q.selector),h=null,n=false;k.filter(q.dropWhitelist).filter(":not("+q.dragBlacklist+")").draggable({addClasses:false,containment:"document",zIndex:9999,drag:function(s,r){l(s,r)},start:function(s,r){i(s,r)}});function i(s,r){h=e(s.target);if(q.dragClone){$clone=h.clone().insertBefore(h).addClass("ss-clone")}h.addClass("ss-moving")}function l(s,r){if(!n){n=true;position=p.getIntendedPosition(s);k=$curContainer.children(":not(.ss-moving):visible");if(position!=k.size()){$target=k.get(position);h.insertBefore($target)}else{$target=k.get(position-1);h.insertAfter($target)}$curContainer.trigger("ss-event-arrange");e(".ss-prev-container").trigger("ss-event-arrange");c.setTimeout(function(){n=false},q.animateSpeed/3)}r.position.left=s.pageX-e(s.target).parent().offset().left-(q.childWidth/2);r.position.top=s.pageY-e(s.target).parent().offset().top-(h.outerHeight()/2)}o.droppable({accept:q.dropWhitelist,drop:function(r){j(r)},over:function(r){m(r)}});function j(r){h=e(".ss-moving").removeClass("ss-moving");$selectedContainer=h.parent();$clone=e(".ss-clone");if($clone[0]){$cloneContainer=$clone.parent();if($cloneContainer[0]===$selectedContainer[0]){$clone.remove()}else{$clone.removeClass("ss-clone");$cloneContainer.trigger("ss-event-dragreset");h.parent().trigger("ss-event-dragreset")}}$selectedContainer.trigger("ss-event-arrange").trigger("ss-event-dropped",h)}function m(r){$curContainer.addClass("ss-prev-container");$curContainer=e(r.target).removeClass("ss-prev-container")}};b.prototype.getPositions=function(w,r){var x=this,y=x.options,q=w.children(y.selector).filter(":visible"),l=y.columns,u=[],p=null,t=y.paddingX,o=[];if(r){q=q.not(".ss-moving")}if(!y.childWidth){y.childWidth=q.first().outerWidth(true)}p=y.childWidth+y.gutterX;if(!l){l=Math.floor(w.innerWidth()/p)}if(y.centerGrid){t=Math.floor(((w.innerWidth()/p)%1*p)/2)+(y.gutterX/2)}for(var n=0;n<l;n++){u.push(y.paddingY)}for(var k=0;k<q.length;k++){var h=e(q[k]),j=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+y.gutterY,s=(p*j)+t,m=u[j];attributes={left:s,top:m};o[k]=attributes;u[j]+=v}if(y.enableAutoHeight){y.containerHeight=Math.max.apply(Math,u)}return o};b.prototype.getIntendedPosition=function(k){var q=this,r=q.options,h=e(".ss-moving"),o=h.parent(),p=0,m=h.position().left+(r.childWidth/2),l=h.position().top+(h.outerHeight()/2),n=9999,j=q.getPositions(o,true),i=j.length-r.dropCutoff;for(hov_i=0;hov_i<j.length;hov_i++){if(hov_i<i){attributes=j[hov_i];if(m>attributes.left&&l>attributes.top){xDist=m-attributes.left;yDist=l-attributes.top;distance=Math.sqrt((xDist*xDist)+(yDist*yDist));if(distance<n){n=distance;p=hov_i;if(hov_i===j.length-1){$object=o.children().not(".ss-moving");if(yDist>($object.outerHeight()*0.9)||xDist>r.childWidth*0.9){p++}}}}}}return p};b.prototype.resize=function(){var i=this,j=e(i.element),h=false;e(c).on("resize",function(){if(!h){h=true;j.trigger("ss-event-arrange");setTimeout(function(){h=false},200)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));